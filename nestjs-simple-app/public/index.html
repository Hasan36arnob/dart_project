<!DOCTYPE html>
<html ng-app="todoApp">
<head>
    <title>Todo App - Full Stack Angular + NestJS</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 { 
            text-align: center; 
            color: #333; 
            margin-bottom: 30px;
        }
        .todo-form {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        .todo-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .todo-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .add-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .add-btn:hover {
            background: #5a6fd8;
        }
        .todo-list {
            list-style: none;
            padding: 0;
        }
        .todo-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .todo-item.completed {
            opacity: 0.7;
            border-left-color: #28a745;
        }
        .todo-checkbox {
            margin-right: 15px;
            transform: scale(1.3);
        }
        .todo-text {
            flex: 1;
            font-size: 16px;
        }
        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #6c757d;
        }
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .delete-btn:hover {
            background: #c82333;
        }
        .stats {
            margin-top: 30px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 8px;
            text-align: center;
        }
        .loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container" ng-controller="TodoController">
        <h1>üìù Todo App - Full Stack</h1>
        
        <!-- Add Todo Form -->
        <div class="todo-form">
            <input 
                type="text" 
                ng-model="newTodo" 
                placeholder="Enter a new todo..." 
                class="todo-input"
                ng-keyup="$event.keyCode === 13 && addTodo()"
            >
            <button ng-click="addTodo()" class="add-btn">Add Todo</button>
        </div>

        <!-- Error Message -->
        <div class="error" ng-if="error">{{ error }}</div>

        <!-- Loading Indicator -->
        <div class="loading" ng-if="loading">Loading todos...</div>

        <!-- Todo List -->
        <ul class="todo-list" ng-if="!loading">
            <li 
                ng-repeat="todo in todos" 
                class="todo-item" 
                ng-class="{'completed': todo.completed}"
            >
                <input 
                    type="checkbox" 
                    ng-model="todo.completed" 
                    ng-change="toggleTodo(todo)"
                    class="todo-checkbox"
                >
                <span class="todo-text">{{ todo.title }}</span>
                <small style="margin-left: 10px; color: #6c757d;">
                    {{ todo.createdAt | date:'medium' }}
                </small>
                <button 
                    ng-click="deleteTodo(todo)" 
                    class="delete-btn"
                >
                    Delete
                </button>
            </li>
        </ul>

        <!-- Empty State -->
        <div class="loading" ng-if="todos.length === 0 && !loading">
            No todos yet. Add one above!
        </div>

        <!-- Statistics -->
        <div class="stats" ng-if="todos.length > 0">
            <strong>Total: {{ todos.length }}</strong> | 
            <strong style="color: #28a745;">Completed: {{ completedCount }}</strong> | 
            <strong style="color: #dc3545;">Pending: {{ pendingCount }}</strong>
        </div>
    </div>

    <script>
        angular.module('todoApp', [])
        .controller('TodoController', ['$scope', '$http', function($scope, $http) {
            $scope.todos = [];
            $scope.newTodo = '';
            $scope.loading = false;
            $scope.error = '';

            // Load all todos on startup
            $scope.loadTodos = function() {
                $scope.loading = true;
                $scope.error = '';
                $http.get('/api/todos')
                    .then(function(response) {
                        $scope.todos = response.data;
                        $scope.loading = false;
                    })
                    .catch(function(error) {
                        $scope.error = 'Error loading todos: ' + error.data?.message || 'Server error';
                        $scope.loading = false;
                    });
            };

            // Add new todo
            $scope.addTodo = function() {
                if (!$scope.newTodo.trim()) return;
                
                $scope.error = '';
                $http.post('/api/todos', { title: $scope.newTodo.trim() })
                    .then(function(response) {
                        $scope.todos.push(response.data);
                        $scope.newTodo = '';
                    })
                    .catch(function(error) {
                        $scope.error = 'Error adding todo: ' + error.data?.message || 'Server error';
                    });
            };

            // Toggle todo completion
            $scope.toggleTodo = function(todo) {
                $scope.error = '';
                $http.put('/api/todos/' + todo.id, { completed: todo.completed })
                    .then(function(response) {
                        // Update the todo with server response
                        angular.extend(todo, response.data);
                    })
                    .catch(function(error) {
                        $scope.error = 'Error updating todo: ' + error.data?.message || 'Server error';
                        // Revert the change on error
                        todo.completed = !todo.completed;
                    });
            };

            // Delete todo
            $scope.deleteTodo = function(todo) {
                $scope.error = '';
                $http.delete('/api/todos/' + todo.id)
                    .then(function() {
                        // Remove from local array
                        var index = $scope.todos.indexOf(todo);
                        if (index > -1) {
                            $scope.todos.splice(index, 1);
                        }
                    })
                    .catch(function(error) {
                        $scope.error = 'Error deleting todo: ' + error.data?.message || 'Server error';
                    });
            };

            // Computed properties for statistics
            $scope.$watch('todos', function() {
                $scope.completedCount = $scope.todos.filter(function(todo) {
                    return todo.completed;
                }).length;
                $scope.pendingCount = $scope.todos.length - $scope.completedCount;
            }, true);

            // Initialize
            $scope.loadTodos();
        }]);
    </script>
</body>
</html>